{% extends '../layout/dash_base_docente.html' %} 
{% load static %}
{% load crispy_forms_tags %}

{% block content %}  

<style>
    hr {
        border: 1px solid #ccc; /* Estilo del borde */
        margin: 20px 0;        /* Márgenes superior e inferior */
    }
</style>




<div class="input-group">
    <button class="btn btnnav" type="button" id="button-addon2" onclick="goBack()"><i class="fa-solid fa-chevron-left"></i></button>
    <div class="col text-center text-bg-dark">
        <h1>Agendar Salida a Terreno</h1>
    </div>
    <button class="btn btnnav" type="button" id="button-addon2" onclick="redirigir()"><i class="fa-solid fa-question"></i></button>
</div>

<div class="container justify-content-center py-4">
    <div class="card p-4">
        <form method="post" action="{% url 'crear_salida' %}" id="myForm">
            {% csrf_token %}
            <div class="d-flex align-items-center pb-3">
                <label style="margin-right: 12px;" for="">Situacion: </label>
                {{ form.situacion }}
            </div>

            <hr>

            <div class="pb-3">
                <div class="form-floating">
                    {{ form.numero_cuenta }}
                    <label class="form-label" for="typeNumber">Numero de cuenta...</label>
                </div>
            </div>

            <hr>

            <div class="d-flex align-items-center pb-3">
                <label style="margin-right: 12px;" for="">Semestre:</label>
                {{ form.semestre }}
            </div>

            <hr>


            <div class="pb-3">
                <div class="form-floating">
                    {{ form.anio }}
                    <label for="floatingTextarea">Año...</label>
                </div>
            </div>

            <hr>
            
            <div class="pb-3">
                <div class="form-floating">
                    {{ form.semana }}
                    <label for="floatingTextarea">Semana...</label>
                </div>
            </div>

            <hr>

            <div class="d-flex align-items-center pb-3">
                <label style="margin-right: 12px;" for="">Actividad:</label>
                {{ form.actividad }}
            </div>

            <hr>
            
            <div class="d-flex pb-3">
                <label for="fecha">Fecha Ingreso:</label>
                {{ form.fecha_ingreso }}
            </div>

            <hr>

            <div class="d-flex pb-3">       
                <label for="fecha">Fecha Termino:</label>
                {{ form.fecha_termino }}
            </div>

            <hr>
            
            <div class="d-flex pb-3">
                <div class="form-floating mgr">
                    {{ form.dias }}
                    <label for="floatingTextarea">Dias...</label>
                </div>

                <hr>
            
                <div class="form-floating">
                    {{ form.noches }}
                    <label for="floatingTextarea">Noches...</label>
                </div>

                
            </div>

            <hr>
            <p class='h5'>DÍAS  SEMANA:</p>

        {% for checkbox in form.diasemana %}
        <div class="form-check form-check-inline">
        {{ checkbox.tag }}
        <label class="form-check-label" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
        </div>
        {% endfor %}

        <hr>


            
        
            <div class="form-floating pb-3">
                {{ form.lugar_ejecucion }}
                <label for="floatingTextarea">Lugar de Ejecucion...</label>
            </div>

            <hr>

          

            <div class="d-flex align-items-center pb-3">
                <label style="margin-right: 12px;" for="">Exp. de aprendizaje:</label>
                {{ form.exp_aprendizaje }}
            </div>

            <hr>

            <div class="form-floating pb-3">
                {{ form.num_alumnos }}
                <label class="form-label" for="typeNumber">Numero de alumnos</label>
            </div>

            <hr>

            <p class='h5'>Asig. comp. terreno:</p>

            {% for checkbox in form.asignaturas %}
            <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                    {{ checkbox.choice_label }}
                </label>
            </div>
            {% endfor %}

            <div id="secciones-container">
                <!-- Iterar sobre los datos de las secciones -->
                {% for seccion in secciones %}
                <div class="form-check">
                    <!-- Mostrar el nombre de la asignatura y el nombre de la sección -->
                    <label class="form-check-label">
                        {{ seccion.asignatura }} - {{ seccion.seccion }}
                        <input class="form-check-input" type="checkbox" name="secciones" value="{{ seccion.id }}">
                    </label>
                </div>
                {% endfor %}
            </div>

            {% comment %} <hr>
            
            <p class='h4'>Seccion por docente:</p>

                {% for checkbox in form.secciones %}
                <div class="form-check">
                    {{ checkbox.tag }}
                    <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                        {{ checkbox.choice_label }}
                    </label>
                </div>
                {% endfor %} {% endcomment %}
            <hr>


            
              

            <div class="d-flex align-items-center pb-3">
                <label style="margin-right: 12px;" for="">Docente titular:</label>
                {{ form.docente_titular }}
            </div>
            
            <hr>

            <p class='h5'>Docentes de apoyo...:</p>

            {% for checkbox in form.docentes_apoyo %}
            <div class="form-check">
                {{ checkbox.tag }}
                <label class="form-check-label" for="{{ checkbox.id_for_label }}">
                    {{ checkbox.choice_label }}
                </label>
            </div>
            {% endfor %}


            <hr>




            

            <div class="form-floating pb-3">
                {{ form.num_salida }}
                <label class="form-label" for="typeNumber">Numero de salida</label>
            </div>


           


            <hr>
            
            <div class="form-floating pb-3">
                {{ form.observaciones }}
                <label for="floatingTextarea2">Observaciones...</label>
            </div>


            <hr>

            <div class="d-grid gap-2 col-6 mx-auto">
                <a href="{% url 'listar_alumnos_sl' %}" class="btn btnagre" type="button">Listar Alumnos</a>
                <button class="btn btnagre" type="button" onclick="submitForm()">Generar salida a Terreno <i class="fa-regular fa-square-plus mas"></i></button>

            </div>


   

            <script>
                function submitForm() {
                    // Obtener todos los campos de entrada del formulario
                    var formElements = document.getElementById("myForm").elements;
            
                    // Verificar si algún campo está vacío
                    for (var i = 0; i < formElements.length; i++) {
                        if (formElements[i].type !== "button" && formElements[i].value === "") {
                            alert("Por favor, complete todos los campos antes de enviar el formulario.");
                            return false; // Evita que el formulario se envíe si hay campos vacíos
                        }
                    }
            
                    // Enviar el formulario si todos los campos están completos
                    document.getElementById("myForm").submit();
                }
            </script>
            
        </form>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        var xhr; // Variable para almacenar la solicitud AJAX
        
        // Array para almacenar las secciones seleccionadas antes de modificar las asignaturas
        var seccionesSeleccionadasAntes = [];
    
        $('input[name="asignaturas"]').change(function() {
            // Abortar la solicitud AJAX anterior si aún está en curso
            if (xhr && xhr.readyState != 4) {
                xhr.abort();
            }
            
            // Obtener las asignaturas seleccionadas
            var asignaturasSeleccionadas = $('input[name="asignaturas"]:checked').map(function() {
                return this.value;
            }).get();
    
            // Almacenar las secciones seleccionadas antes de modificar las asignaturas
            seccionesSeleccionadasAntes = $('input[name="secciones"]:checked').map(function() {
                return this.value;
            }).get();
            
            // Realizar la solicitud AJAX para obtener las nuevas secciones
            xhr = $.ajax({
                url: '{% url 'obtener_secciones' %}',
                method: 'GET',
                data: {
                    asignaturas: asignaturasSeleccionadas
                },
                success: function(data) {
                    // Limpiar el contenedor de secciones
                    $('#secciones-container').empty();
                    
                    // Iterar sobre las secciones obtenidas y agregar checkboxes al formulario
                    data.forEach(function(seccion) {
                        // Crear un nuevo elemento de checkbox
                        var checkbox = $('<input>').attr({
                            type: 'checkbox',
                            name: 'secciones',
                            value: seccion.id,
                            id: 'seccion-' + seccion.id // Asigna un ID único para cada checkbox
                        });
                        var label = $('<label>').attr('for', 'seccion-' + seccion.id).text(seccion.asignatura + ' - ' + seccion.seccion);

                        
                        // Verificar si la sección estaba seleccionada antes de modificar las asignaturas
                        if (seccionesSeleccionadasAntes.includes(seccion.id.toString())) {
                            checkbox.prop('checked', true);
                        }
                        
                        // Agregar el checkbox y su etiqueta al contenedor de secciones
                        $('#secciones-container').append(checkbox);
                        $('#secciones-container').append(label);
                        $('#secciones-container').append('<br>'); // Agregar un salto de línea para separar los checkboxes
                    });
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        });
    });
         
</script>


   

{% endblock %} 